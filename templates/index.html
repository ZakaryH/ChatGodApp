<!DOCTYPE HTML>
<html>
<head>
    
    <title>DougDoug Chat God App</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.4/socket.io.js" integrity="sha512-aMGMvNYu8Ue4G+fHa359jcPb1u+ytAF+P2SCb+PxrjCdO3n3ZTxJ30zuH39rimUggmTwmh2u7wvQsDTHESnmfQ==" crossorigin="anonymous"></script>
    <!-- Note: we are getting a local script,  -->
    <script src="https://cdn.jsdelivr.net/npm/jquery-textfill@0.6.0/source/jquery.textfill.min.js"></script>
    
    <script type="text/javascript" charset="utf-8">
        $(document).ready(function() {
            var socket = io();
            
            // Handle incoming messages
            socket.on('message_send', function(msg, cb) {
                console.log("Got data: " + msg);

                // Update message and username
                $('#user-message-' + msg.user_number).text(msg.message);
                $('#user-name-' + msg.user_number).text(msg.current_user[0].toUpperCase() + msg.current_user.substr(1));

                // Apply textfill to all user elements
                applyTextFillToAllUsers();

                if (cb) cb();
            });

            // Apply textfill to all user elements
            function applyTextFillToAllUsers() {
                for (let i = 1; i <= 3; i++) {
                    $('#user-name-box-' + i).textfill({
                        minFontPixels: 2,
                        maxFontPixels: 50,
                        explicitHeight: 60
                    });
                    $('#user-message-box-' + i).textfill({
                        minFontPixels: 2,
                        maxFontPixels: 30
                    });
                }
            }

            // Setup event handlers for all users
            for (let userNum = 1; userNum <= 3; userNum++) {
                setupUserEventHandlers(userNum);
            }

            function setupUserEventHandlers(userNum) {
                // Pick random event
                $(`#pickrandom${userNum}`).submit(function(event) {
                    socket.emit('pickrandom', {'user_number': userNum.toString()});
                    return false;
                });

                // TTS toggle event
                $(`#tts${userNum}`).change(function(event) {
                    socket.emit('tts', {
                        'user_number': userNum.toString(),
                        'checked': $(`#checkbox${userNum}`).prop('checked')
                    });
                    return false;
                });

                // Choose user event
                $(`#choose${userNum}`).submit(function(event) {
                    socket.emit('choose', {
                        'user_number': userNum.toString(),
                        'chosen_user': $(`form#choose${userNum} input`).val()
                    });
                    $(`form#choose${userNum} input`).val('');
                    return false;
                });

                // Voice name change event
                $(`#voicename${userNum}`).change(function() {
                    socket.emit('voicename', {
                        'user_number': userNum.toString(), 
                        'voice_name': $(this).val()
                    });
                });

                // Voice style change event
                $(`#voicestyle${userNum}`).change(function() {
                    socket.emit('voicestyle', {
                        'user_number': userNum.toString(), 
                        'voice_style': $(this).val()
                    });
                });
            }
        });
    </script>
</head>
<body>
    <h1 style="margin-bottom: 10px;">Holy Chat God Selector</h1>
    <div style="display:flex; flex-direction:row;">

        <div>
            <form id="pickrandom1" method="POST" action="#" >
                <input type="submit" value="Pick Random" id="pick-random-input" style="border-color: #ccc; border-radius: 10px;">
            </form>
            <form id="tts1" method="POST" action="#">
                <label for="tts">TTS 1:</label>
                <input id="checkbox1" type="checkbox" class="tts-checkbox" style="text-align: left;" value="tts" name="tts" checked>
            </form> 
            <br><br>
            <form id="choose1" class="choose-box" method="POST" action="#">
                <label for="tts">Choose User:</label>
                <input type="text" class="choose">
            </form> 
            <br><br>
            <select id="voicename1">
              <option value="en-US-DavisNeural">Davis</option>
              <option value="en-US-TonyNeural">Tony</option>
              <option value="en-US-JasonNeural">Jason</option>
              <option value="en-US-GuyNeural">Guy</option>
              <option value="en-US-JaneNeural">Jane</option>
              <option value="en-US-NancyNeural">Nancy</option>
              <option value="en-US-JennyNeural">Jenny</option>
              <option value="en-US-AriaNeural">Aria</option>
            </select>
            <select id="voicestyle1">
              <option value="random">random</option>
              <option value="angry">angry</option>
              <option value="cheerful">cheerful</option>
              <option value="excited">excited</option>
              <option value="hopeful">hopeful</option>
              <option value="sad">sad</option>
              <option value="shouting">shouting</option>
              <option value="terrified">terrified</option>
              <option value="unfriendly">unfriendly</option>
              <option value="whispering">whispering</option>
            </select>
            <br><br>
            <div class="user-name-box" id="user-name-box-1"> 
                <span class="user-name" id="user-name-1">Temp User</span>
            </div>
            <div class="user-message-box" id="user-message-box-1">
                <span class="user-message" id="user-message-1" >Temp message</span>
            </div>
        </div>

        <!-- 3 Player Distance -->
        <div style="width: 87px;"></div>

        <div>
            <form id="pickrandom2" method="POST" action="#" >
                <input type="submit" value="Pick Random" id="pick-random-input" style="border-color: #ccc; border-radius: 10px;">
            </form>
            <form id="tts2" method="POST" action="#">
                <label for="tts">TTS 2:</label>
                <input id="checkbox2" type="checkbox" class="tts-checkbox" style="text-align: left;" value="tts" name="tts" checked>
            </form> 
            <br><br>
            <form id="choose2" class="choose-box" method="POST" action="#">
                <label for="tts">Choose User:</label>
                <input type="text" class="choose">
            </form> 
            <br><br>
            <select id="voicename2">
              <option value="en-US-DavisNeural">Davis</option>
              <option value="en-US-TonyNeural">Tony</option>
              <option value="en-US-JasonNeural">Jason</option>
              <option value="en-US-GuyNeural">Guy</option>
              <option value="en-US-JaneNeural">Jane</option>
              <option value="en-US-NancyNeural">Nancy</option>
              <option value="en-US-JennyNeural">Jenny</option>
              <option value="en-US-AriaNeural">Aria</option>
            </select>
            <select id="voicestyle2">
              <option value="random">random</option>
              <option value="angry">angry</option>
              <option value="cheerful">cheerful</option>
              <option value="excited">excited</option>
              <option value="hopeful">hopeful</option>
              <option value="sad">sad</option>
              <option value="shouting">shouting</option>
              <option value="terrified">terrified</option>
              <option value="unfriendly">unfriendly</option>
              <option value="whispering">whispering</option>
            </select>
            <br><br>
            <div class="user-name-box" id="user-name-box-2"> 
                <span class="user-name" id="user-name-2">Temp User</span>
            </div>
            <div class="user-message-box" id="user-message-box-2">
                <span class="user-message" id="user-message-2" >Temp message</span>
            </div>
        </div>

        <!-- 3 Player Distance -->
        <div style="width: 87px;"></div>

        <div>
            <form id="pickrandom3" method="POST" action="#" >
                <input type="submit" value="Pick Random" id="pick-random-input" style="border-color: #ccc; border-radius: 10px;">
            </form>
            <form id="tts3" method="POST" action="#">
                <label for="tts">TTS 3:</label>
                <input id="checkbox3" type="checkbox" class="tts-checkbox" style="text-align: left;" value="tts" name="tts" checked>
            </form> 
            <br><br>
            <form id="choose3" class="choose-box" method="POST" action="#">
                <label for="tts">Choose User:</label>
                <input type="text" class="choose">
            </form> 
            <br><br>
            <select id="voicename3">
              <option value="en-US-DavisNeural">Davis</option>
              <option value="en-US-TonyNeural">Tony</option>
              <option value="en-US-JasonNeural">Jason</option>
              <option value="en-US-GuyNeural">Guy</option>
              <option value="en-US-JaneNeural">Jane</option>
              <option value="en-US-NancyNeural">Nancy</option>
              <option value="en-US-JennyNeural">Jenny</option>
              <option value="en-US-AriaNeural">Aria</option>
            </select>
            <select id="voicestyle3">
              <option value="random">random</option>
              <option value="angry">angry</option>
              <option value="cheerful">cheerful</option>
              <option value="excited">excited</option>
              <option value="hopeful">hopeful</option>
              <option value="sad">sad</option>
              <option value="shouting">shouting</option>
              <option value="terrified">terrified</option>
              <option value="unfriendly">unfriendly</option>
              <option value="whispering">whispering</option>
            </select>
            <br><br>
            <div class="user-name-box" id="user-name-box-3"> 
                <span class="user-name" id="user-name-3">Temp User</span>
            </div>
            <div class="user-message-box" id="user-message-box-3">
                <span class="user-message" id="user-message-3" >Temp message</span>
            </div>
        </div>

    </div>
</body>
</html>